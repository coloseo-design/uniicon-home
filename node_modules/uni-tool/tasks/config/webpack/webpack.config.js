/* eslint-disable @typescript-eslint/no-var-requires */
/* eslint-disable import/no-dynamic-require */
/* eslint-disable global-require */
const path = require('path');
const { getBaseWebpackConfig } = require('./getBaseWebpackConfig');
const { isFileExist, getUniFile } = require('../../../utils/file');

module.exports = function webpack(workspace, mode) {
  let webpackConfig = getBaseWebpackConfig(workspace, mode);
  const webpackConfigFileName = path.resolve(workspace, 'webpack.config.js');
  if (isFileExist(webpackConfigFileName)) {
    webpackConfig = require(webpackConfigFileName);
  }
  if (mode === 'development') {
    Object.assign(webpackConfig, {
      devtool: getUniFile().devtool || 'inline-source-map',
    });
  }
  return webpackConfig;
};
