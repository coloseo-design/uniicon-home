/* eslint-disable global-require */
/* eslint-disable no-nested-ternary */
/* eslint-disable import/no-dynamic-require */
/* eslint-disable @typescript-eslint/no-var-requires */
const path = require('path');
const chalk = require('chalk');
const { isFileExist, getUniFile } = require('../../../utils/file');

/**
 * 配置htmlWeboackPlugin模板
 * 如果在指定的工作目录[workspace]存在assets/template.html，则加载指定的模板文件
 * 否则加载默认的模板文件
 * @param {*} workspace
 * @author luobodng
 */

module.exports.getHtmlWebpackPluginConfig = function getHtmlWebpackPluginConfig(workspace) {
  const consfig = {};
  process.stdout.write(chalk.green('开始尝试加载工作目录assets/template.html...\n'));
  const templatePath = path.join(workspace, 'assets/template.html');
  if (isFileExist(templatePath)) {
    Object.assign(consfig, {
      template: templatePath,
    });
  } else {
    process.stdout.write(chalk.green('html模板加载失败，尝试使用默认模板\n'));
    Object.assign(consfig, {
      title: getUniFile().htmlTitle || 'Uni design',
      templateContent: ({ htmlWebpackPlugin }) => `
        <!DOCTYPE html>
        <html>
          <head>
            <meta charset="utf-8"/>
            <title>${htmlWebpackPlugin.options.title}</title>
          </head>
          <body>
            <div id="root"></div>
            </body>
        </html>
          `,
    });
  }
  return consfig;
};
